<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ProStroy — Договор подряда с физическим лицом</title>
  <meta name="color-scheme" content="dark">
  <link rel="stylesheet" href="assets/styles/base.css">
  <link rel="stylesheet" href="assets/styles/header.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js" defer></script>
  <script src="/js/supabaseClient.js" defer></script>
  <script src="/header.js" defer></script>
</head>
<body style="--bg-video-filter: brightness(0.7);">
  <video class="bg" autoplay muted loop playsinline preload="auto">
    <source src="https://assets.mixkit.co/videos/30431/30431-720.mp4" type="video/mp4">
  </video>

  <div id="header"></div>

  <div class="wrap">
    <div class="page">
      <section class="card">
        <h1>Договор подряда с физическим лицом</h1>
        <p>Шаблон для оформления работ с физическим лицом или самозанятым. Включает данные исполнителя, предмет, вознаграждение, налоги и порядок сдачи.</p>

        <form id="indForm">
          <div class="grid-2">
            <div class="row">
              <label for="date">Дата заключения *</label>
              <input id="date" type="date" required>
            </div>
            <div class="row">
              <label for="number">Номер</label>
              <input id="number" placeholder="ФЛ-2024/05">
            </div>
          </div>

          <div class="row">
            <label for="customer">Заказчик *</label>
            <textarea id="customer" required placeholder="ООО «Прострой», реквизиты, представитель"></textarea>
          </div>

          <div class="row">
            <label for="contractor">Исполнитель (ФИО, паспортные данные) *</label>
            <textarea id="contractor" required placeholder="Иванов Иван Иванович, паспорт ..., ИНН ..., адрес"></textarea>
          </div>

          <div class="row">
            <label for="subject">Предмет договора *</label>
            <textarea id="subject" required placeholder="Выполнение работ по разработке дизайн-проекта интерьера"></textarea>
          </div>

          <div class="grid-2">
            <div class="row">
              <label for="term">Сроки выполнения *</label>
              <input id="term" required placeholder="с 01.07.2024 по 31.07.2024">
            </div>
            <div class="row">
              <label for="price">Вознаграждение *</label>
              <input id="price" required placeholder="150 000 руб. (NDFL удерживается заказчиком)">
            </div>
          </div>

          <div class="row">
            <label for="payment">Порядок расчётов *</label>
            <textarea id="payment" required placeholder="50% аванс, 50% после подписания акта, перечисление на банковский счёт"></textarea>
          </div>

          <div class="row">
            <label for="result">Результат работ и сдача *</label>
            <textarea id="result" required placeholder="Исполнитель передаёт готовый дизайн-проект в электронном виде, акт выполненных работ"></textarea>
          </div>

          <div class="row">
            <label for="responsibility">Ответственность и штрафы</label>
            <textarea id="responsibility" placeholder="Штраф за просрочку 0,2% в день, возмещение ущерба"></textarea>
          </div>

          <div class="row">
            <label for="confidentiality">Конфиденциальность и использование материалов</label>
            <textarea id="confidentiality" placeholder="Запрет на разглашение информации, передача исключительных прав"></textarea>
          </div>

          <div class="row">
            <label for="taxes">Налоги и страховые взносы</label>
            <textarea id="taxes" placeholder="Заказчик удерживает и перечисляет НДФЛ, страховые взносы не начисляются"></textarea>
          </div>

          <div class="row">
            <label for="termination">Расторжение и отказ</label>
            <textarea id="termination" placeholder="Заказчик вправе отказаться при оплате фактически выполненных работ"></textarea>
          </div>

          <div class="actions">
            <button class="btn btn-primary" type="submit">Сформировать текст</button>
            <button class="btn btn-ghost" type="button" id="copyBtn">Скопировать</button>
            <button class="btn btn-ghost" type="button" id="downloadBtn">Скачать TXT</button>
          </div>
        </form>
      </section>

      <section class="card">
        <h2>Предпросмотр</h2>
        <div id="preview" class="preview">Заполните данные, чтобы сформировать договор.</div>
      </section>
    </div>
  </div>

  <script type="module">
    const headerReady = window.headerReady || Promise.resolve();
    
    await headerReady;

    const byId = (id)=>document.getElementById(id);
    const preview = byId("preview");

    function formatPreview(){
      const date = byId("date").value ? new Date(byId("date").value).toLocaleDateString() : "[дата]";
      const number = byId("number").value.trim();
      const customer = byId("customer").value.trim() || "[Заказчик]";
      const contractor = byId("contractor").value.trim() || "[Исполнитель]";
      const subject = byId("subject").value.trim() || "[Предмет]";
      const term = byId("term").value.trim() || "[Срок]";
      const price = byId("price").value.trim() || "[Вознаграждение]";
      const payment = byId("payment").value.trim() || "[Порядок расчётов]";
      const result = byId("result").value.trim() || "[Результат и акт]";
      const responsibility = byId("responsibility").value.trim();
      const confidentiality = byId("confidentiality").value.trim();
      const taxes = byId("taxes").value.trim();
      const termination = byId("termination").value.trim();

      let text = `ДОГОВОР ПОДРЯДА ${number ? `№ ${number}` : ""}\n\nг. ____________ ${date}\n\n${customer}, именуемое "Заказчик", и ${contractor}, именуемое "Исполнитель", заключили настоящий договор о нижеследующем.\n\n`;

      text += `1. Предмет договора\n1.1. Исполнитель обязуется выполнить работы: ${subject}, а Заказчик принять результат и оплатить.\n`;

      text += `\n2. Срок выполнения\n2.1. Работы выполняются в период: ${term}.\n`;

      text += `\n3. Вознаграждение и расчёты\n3.1. Вознаграждение составляет ${price}.\n3.2. Порядок расчётов: ${payment}.\n`;

      text += `\n4. Результат работ и сдача\n4.1. ${result}.\n`;

      if (responsibility){ text += `\n5. Ответственность сторон\n${responsibility}\n`; }
      if (confidentiality){ text += `\n6. Конфиденциальность и права\n${confidentiality}\n`; }
      if (taxes){ text += `\n7. Налоги и страховые взносы\n${taxes}\n`; }
      if (termination){ text += `\n8. Расторжение и отказ\n${termination}\n`; }

      text += "\nНастоящий договор составлен в двух экземплярах.\n\nЗаказчик _______________________\nИсполнитель ____________________\n";

      preview.textContent = text;
      return text;
    }

    byId("indForm").addEventListener("submit", (evt)=>{
      evt.preventDefault();
      formatPreview();
      preview.scrollIntoView({ behavior:"smooth", block:"start" });
    });

    function copyPreview(){
      const text = formatPreview();
      navigator.clipboard?.writeText(text).then(()=> window.alert("Текст договора скопирован."))
        .catch(()=> window.alert("Не удалось скопировать текст."));
    }

    function downloadPreview(){
      const text = formatPreview();
      const blob = new Blob([text], { type:"text/plain;charset=utf-8" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = `dogovor-fl-${byId("number").value || "draft"}.txt`;
      link.click();
      URL.revokeObjectURL(link.href);
    }

    byId("copyBtn").addEventListener("click", copyPreview);
    byId("downloadBtn").addEventListener("click", downloadPreview);
  </script>
</body>
</html>
